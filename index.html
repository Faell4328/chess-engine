<meta charset="utf-8" />
<link
  rel="stylesheet"
  href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"
  crossorigin="anonymous"
/>

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  crossorigin="anonymous"
></script>
<script
  src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"
  crossorigin="anonymous"
></script>
<script src="./variaveis.js"></script>
<script src="./utilitarios.js"></script>
<script src="./calcular.js"></script>
<script src="./chess.js"></script>

<div>
  <div style="width: 700px; height: 700px" id="tabuleiro"></div>
  <br />
  <input type="text" id="fen" placeholder="FEN personalizado" />
  <button style="margin-left: 5" onClick="carregarFenPersonalizado()">
    Usar FEN personalizado</button
  ><br /><br />
  <button onclick="resetar_partida()">Reiniciar partida</button>
  <audio id="audio" src="#"></audio>
  <p id="aviso"></p>
</div>

<div style="padding-top: 10px">
  <hr />
  <h3 id="titulo_relatorio">Relatórios</h3>
</div>

<div style="padding: 0px 10px 20px 10px">
  <div>
    <h4>Movimentos possíveis</h4>
    <details style="padding: 10px">
      <summary>Peao</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_movimentos_p"
      ></div>
    </details>
    <details style="padding: 10px">
      <summary>Cavalo</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_movimentos_n"
      ></div>
    </details>
    <details style="padding: 10px">
      <summary>Bispo</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_movimentos_b"
      ></div>
    </details>
    <details style="padding: 10px">
      <summary>Torre</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_movimentos_r"
      ></div>
    </details>
    <details style="padding: 10px">
      <summary>Rainha</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_movimentos_q"
      ></div>
    </details>
    <details style="padding: 10px">
      <summary>Rei</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_movimentos_k"
      ></div>
    </details>
  </div>

  <hr />

  <div>
    <h4>Capturas possíveis</h4>
    <details style="padding: 10px">
      <summary>Peao</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_capturas_p"
      ></div>
    </details>
    <details style="padding: 10px">
      <summary>Cavalo</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_capturas_n"
      ></div>
    </details>
    <details style="padding: 10px">
      <summary>Bispo</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_capturas_b"
      ></div>
    </details>
    <details style="padding: 10px">
      <summary>Torre</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_capturas_r"
      ></div>
    </details>
    <details style="padding: 10px">
      <summary>Rainha</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_capturas_q"
      ></div>
    </details>
    <details style="padding: 10px">
      <summary>Rei</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_capturas_k"
      ></div>
    </details>
 </div>

  <hr />

  <div>
    <h4>Movimentos especiais possíveis (en passant e roque)</h4>
    <details style="padding: 10px">
      <summary>En passant</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_en_passant"
      ></div>
    </details>
    <details style="padding: 10px">
      <summary>Roque</summary>
      <div
        style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
        id="container_roque"
      ></div>
    </details>
  </div>
</div>

<div style="padding-top: 10px">
  <hr />
  <h3>Casas atacadas</h3>
</div>
<div style="padding: 0px 10px 20px 10px">
  <details style="padding: 10px">
    <summary>Peao</summary>
    <div
      style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
      id="container_atacando_p"
    ></div>
  </details>

  <details style="padding: 10px">
    <summary>Cavalo</summary>
    <div
      style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
      id="container_atacando_n"
    ></div>
  </details>

  <details style="padding: 10px">
    <summary>Bispo</summary>
    <div
      style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
      id="container_atacando_b"
    ></div>
  </details>

  <details style="padding: 10px">
    <summary>Torre</summary>
    <div
      style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
      id="container_atacando_r"
    ></div>
  </details>

  <details style="padding: 10px">
    <summary>Rainha</summary>
    <div
      style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
      id="container_atacando_q"
    ></div>
  </details>

  <details style="padding: 10px">
    <summary>Rei</summary>
    <div
      style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
      id="container_atacando_k"
    ></div>
  </details>

  <details style="padding: 10px">
    <summary>Todas</summary>
    <div
      style="display: flex; max-width: 100vw; flex-wrap: wrap; gap: 20px"
      id="container_atacando_todas"
    ></div>
  </details>
</div>

<script>
  const board = Chessboard("tabuleiro", {
    position: "start",
    draggable: true,
    onDrop: Chess.mover,
    onSnapEnd: () => {
      board.position(gerarFenDaPosicao());
    },
  });

  document.getElementById("titulo_relatorio").textContent =
    partida_real.jogando == "w"
      ? "Relatório das brancas"
      : "Relatório das pretas";
  const todosMovimentosECaptura = Calcular.todosPossiveisMovimentosDeTodasPecas(
    partida_real.jogando,
  );
  gerarRelatorioMovimento(todosMovimentosECaptura);
  gerarRelatorioCaptura(todosMovimentosECaptura);
  gerarRelatorioMovimentoEspecial(todosMovimentosECaptura);
  Calcular.casasAtacadas(relatorio = true);
</script>
